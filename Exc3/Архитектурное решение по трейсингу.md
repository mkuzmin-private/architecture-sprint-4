# Архитектурное решение по трейсингу
Трейсинг будет добавлять в MES API, CRM API и shop API.

Потенциально проблемные ситуации:
1. Файл эскиза загружен на S3, но по какой-то причине не доступен при попытке расчета в MES.
2. Теряются запросы на обновление статуса заказов.
3. Теряются сообщения при взаимодействии MES и CRM через очередь сообщений.

Данные, которые будем включать в трейсинг:
1. ID заказа;
2. текущий статус заказа;
3. ID текущего эндпоинта;
4. ID окружения (dev/release/prod);
5. ID ноды приложения.

## Мотивация
Система имеет сложную архитектуру. Уже имеются проблемы с обработкой запросов,
причину и источник которых достаточно сложно понять, не имея либо огромного количества
логов, либо трейсинга.

Плюсы от внедрения трейсинга:
1. Облегчается и ускоряется поиск места возникновения ошибки и сопутствующего контекста;
2. Возможность быстрее реагировать на сбои в системе;
3. Можно обойтись меньшим количеством логов (+экономия на инфраструктуре логирования)
4. Улучшит наблюдаемость системы;
5. Поможет выявлять узкие места в производительности системы.

## Предлагаемое решение
Реализовывать трейсинг будем с использованием OpenTelemetry и Jaeger.
Доработать нужно будет компоненты MES API, shop API, CRM API.
```markdown
[С4 диаграмма] (https://disk.yandex.ru/d/8n2YI0Gv3uQSTg)
```

## Компромиссы
На данном этапе трейсинг в очереди сообщений оставим за скобками, так как эта доработка может занять достаточно много времени.

## аспекты безопасности
Необходимо добавить аутентиикацию, чтобы в Jaeger UI вход был доступен только
сотрудникам компании с актуальной учетной записью.
Так же в идеале было бы неплохо ограничить доступ пользователям, находящимся вне корпоративной сети.
