# Выбор и настройка мониторинга в системе

## Мотивация
Система имеет достаточно сложную архитектуру, добавление мониторинга позволит:
1. Улучшить видимость системы;
2. Ускорить рабочий процесс и процессы DevOps;
3. Повысить надежность системы и быстрее решать возникающие проблемы;
4. Собирать ценную информацию, относящуюся к операционной деятельности компании;
5. Выявлять узкие места и повышать производительность системы.

## Выбор подхода к мониторингу
Для мониторинга в системе хорошо подойдет подход «Четыре золотых сигнала»,
его и будем использовать для всех частей системы.

## Какие метрики будем отслеживать
### MES API, CRM API, shop API
**Number of requests (RPS)** - количество поступающих запросов в секунду.

**CPU % usage** - нагрузка на ЦП.

**Memory Utilisation** - использование ОЗУ.

**Number of connections for db instance** - количество активных подключений к БД.

**Unique API Consumers** - количество уникальных пользователей.

**Number of simultanious sessions** - количество одновременных сессий.

**Number of responses** - количество ответов приложения. Добавим ярлыки "status_code", и "url" (на какой запрос был сформирован ответ).

**Number of file uploads** - количество попыток загрузок файлов эскизов изделий. Ярлыки: "file_size_kb", "is_success".

### MES API
Для этой части дополнительно будем мониторить длительность расчета стоимости по эскизу.
Ярлык - "request_source" для того, чтобы понимать источник, от которого пришел запрос на расчет (магазин или сторонние пользователи открытого API)

### RabbitMQ
**Number of message in flight** - количество активных сообщений в очереди.

**Number of dead-letter-exchange letters** - количество сообщений, которые остались необработанными по той или иной причине.

## План действий
Для мониторинга будем использовать стэк Prometeus + Grafana.
1. Добавить конфигурацию для Prometeus;
2. Развертывание Prometeus;
3. Добавление необходимых зависимостей в код приложения;
4. Добавление метрик в приложение;
5. Конфигурирование и развертывание Grafana;
6. Настрока Grafana и создание дашбордов.
